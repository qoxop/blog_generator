"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var myEvent=function(){var a={};return{log:function(){console.log(a)},on:function(e,t){return a[e]||(a[e]=[]),t.stopId=Date.now().toString()+Math.random().toString().replace("0.",""),a[e].push(t),t.stopId},emit:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];a[e]&&a[e].forEach(function(e){e.apply(void 0,n)})},removeListener:function(e,t){a[e]&&(a[e]=a[e].filter(function(e){return e.stopId!==t}))},clearListener:function(e){a[e]=null}}}(),BODY_SCROLL_EVENT={DOWN:"bodyScrollDown",UP:"bodyScrollUp",TOP:"bodyScrollTop",BOTTOM:"bodyScrollBottom",PRELOAD:"needPreload",SCROLL:"bodyOnScroll"},TIME_EVENT={YEAR_ADD:"year_add",SCROLL_TIP_CHANGE:"scroll_tip_change"},request=function(){function r(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var e=["Microsoft.XMLHTTP","MSXML.XMLHTTP","Msxml2.XMLHTTP.7.0","Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.5.0","Msxml2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(e){}}var c={noCache:!1,errHandler:null,responseHandler:function(e){return e}};var t={get:function(e,t,n){var o=r(),a=Object.assign({},c,this.config);if("function"==typeof t&&void 0===n)n=t;else if(void 0!==t){var i=Object.keys(t).map(function(e){return"".concat(e,"=").concat(t[e])}).join("&");i&&(e=/\?/.test(e)?e+"&"+i:e+"?"+i)}a.noCache&&(e=/\?/.test(e)?e+"&noCacheUuid"+Date.now():e+"?noCacheUuid"+Date.now()),o.onreadystatechange=function(){4===o.readyState&&"function"==typeof n&&(200===o.status||304===o.status?"function"==typeof n&&n("function"==typeof a.responseHandler?a.responseHandler(o.responseText):o.responseText):("function"==typeof a.errHandler&&errHandler(o.status),n(o.status,!0)))},o.open("GET",e),o.send()},post:function(e,t,n){var o=r(),a=Object.assign({},c,this.config),i=null;"function"==typeof t&&void 0===n?n=t:void 0!==t&&(i=Object.keys(t).map(function(e){return"".concat(e,"=").concat(t[e])}).join("&")),a.noCache&&(e=/\?/.test(e)?e+"&noCacheUuid"+Date.now():e+"?noCacheUuid"+Date.now()),o.onreadystatechange=function(){4===request.readyState&&"function"==typeof n&&(200===request.status||304===request.status?"function"==typeof n&&n("function"==typeof a.responseHandler?a.responseHandler(request.responseText):request.responseText):("function"==typeof a.errHandler&&errHandler(request.status),n(request.status,!0)))},o.open("POST",e),o.send(i)},setGlobalConfig:function(e){c=Object.assign(c,e)}};return Object.assign(function(e){return Object.assign(t,{config:e})},t)}();function createArticleList(e,a){var i=document.createDocumentFragment(),r=[];return e.forEach(function(t){var n=document.createElement("li"),e=t.updateTime.substr(0,4),o='\n            <div class="time">\n                <time>'.concat(t.updateTime,'</time>\n            </div>\n            <div class="article-info">\n                <div class="article-title">\n                    <a href="').concat(t.url,'" class="article-link iconfont">').concat(t.title,'</a>\n                </div>\n                <div class="article-tags">\n                    ').concat(t.tags.map(function(e){return'<a href="/tags.html#'.concat(e,'">').concat(e,"</a>")}).join(""),"\n                </div>\n            </div>\n        ");n.innerHTML=o,document.getElementById(e)||r.includes(e)||(r.push(e),n.setAttribute("id",e)),a&&setTimeout(function(){var e=t.updateTime.substr(0,7).replace("-","年")+"月";a[e]||(a[e]=n.getBoundingClientRect().y-document.body.getBoundingClientRect().y)},0),i.appendChild(n)}),i}function bodyScrollHandler(){var a=document.body.getBoundingClientRect().y,i=0;document.body.onscroll=function(o){0===i&&(i=setTimeout(function(){i=0;var e=document.body.getBoundingClientRect(),t=e.y,n=e.bottom;myEvent.emit(BODY_SCROLL_EVENT.SCROLL,t),t-a<-1&&myEvent.emit(BODY_SCROLL_EVENT.DOWN,o),1<t-a&&myEvent.emit(BODY_SCROLL_EVENT.UP,o),-1<t&&myEvent.emit(BODY_SCROLL_EVENT.TOP,o),n-window.innerHeight<16&&myEvent.emit(BODY_SCROLL_EVENT.BOTTOM,o),n-window.innerHeight<100&&myEvent.emit(BODY_SCROLL_EVENT.PRELOAD),a=t},50))}}function autoHideHeader(){var e=document.querySelector("body>header");myEvent.on(BODY_SCROLL_EVENT.DOWN,function(){e.setAttribute("class","hide")}),myEvent.on(BODY_SCROLL_EVENT.UP,function(){e.setAttribute("class","")})}function DataController(){this.data=[],this.pageIndex=0,this.hasMore=!0,this.loading=!1,request.setGlobalConfig({responseHandler:function(e){return JSON.parse(e)}}),this.load=function(o){var a=this;!this.loading&&this.hasMore&&(this.loading=!0,request.get("/json/page_".concat(++this.pageIndex,".json"),function(e,t){if(t||e&&e.data&&!e.data.length)a.hasMore=!1;else{a.data=a.data.concat(e.data);var n=Object.keys(e.data.map(function(e){return e.updateTime.substr(0,4)}).reduce(function(e,t){return Object.assign(e,_defineProperty({},t,1))},{})).sort();myEvent.emit(TIME_EVENT.YEAR_ADD,n)}o(t?[]:e.data),a.loading=!1}))},this.preload=function(e){this.data=[],this.pageIndex=0,this.hasMore=!0,this.load(e)},this.fetchAll=function(n){var o=this;request.get("/json/all.json",function(e,t){t||e&&e.data&&!e.data.length?o.hasMore=!1:o.data=e.data,n(t?[]:e.data),o.loading=!1})}}function displayScrollTips(n,o){o||(o=15);var a=document.getElementById("scrollTips");myEvent.on(BODY_SCROLL_EVENT.SCROLL,function(e){for(var t in n)if(-e+o<n[t]){a.innerText=t,myEvent.emit(TIME_EVENT.SCROLL_TIP_CHANGE,t);break}})}function renderHomePage(){var n={};displayScrollTips(n);var o=new DataController;function a(){document.body.getBoundingClientRect().bottom-window.innerHeight<100&&myEvent.emit(BODY_SCROLL_EVENT.PRELOAD)}myEvent.on(BODY_SCROLL_EVENT.PRELOAD,function(){o.load(function(e){if(o.hasMore){var t=document.querySelector("#home_article_list>ul");t?(t.appendChild(createArticleList(e,n)),setTimeout(a,20)):console.error("#home_article_list>ul not exit")}else myEvent.clearListener(BODY_SCROLL_EVENT.PRELOAD)})}),a()}function renderYearBar(){var o={},t=document.getElementById("yearsbar");myEvent.on(TIME_EVENT.YEAR_ADD,function(e){var n=document.createDocumentFragment();e.forEach(function(e){if(!o[e]){var t=document.createElement("li");t.innerHTML='<a href="#'.concat(e,'"><span>').concat(e,"</span></a>"),o[e]=t,n.appendChild(t)}}),n.hasChildNodes()&&t.appendChild(n)}),myEvent.on(TIME_EVENT.SCROLL_TIP_CHANGE,function(e){var t=e.substr(0,4);for(var n in o)t<=n?o[n].setAttribute("class","actived"):o[n].setAttribute("class","unactived")})}function assistToolsHandler(){var e=document.querySelector(".back-to-top"),t=document.querySelector("body>header>div.header"),n="back-to-top";myEvent.on(n,function(){document.body.scrollIntoView()}),e&&e.addEventListener("click",function(){myEvent.emit(n)}),t&&t.addEventListener("dblclick",function(){myEvent.emit(n)})}function createTagPage(i,r){var c=document.createDocumentFragment(),s=document.createDocumentFragment(),e=function(n){var e=document.createElement("li");if(e.innerHTML='<a href="#'.concat(n,'">').concat(n,"</a>"),c.appendChild(e),i[n]&&0<i[n].length){var t=document.createElement("dt");t.innerText=n,t.setAttribute("id",n),s.appendChild(t);var o=document.createElement("dd"),a=document.createElement("ul");a.innerHTML=i[n].reduce(function(e,t){return e+'<li><a class="iconfont" href="'.concat(t.url,'">').concat(t.title,"</a></li>")},""),o.appendChild(a),s.appendChild(o),setTimeout(function(){var e=o.getBoundingClientRect().bottom,t=o.getBoundingClientRect().top;r[n]=(e+t)/2-document.body.getBoundingClientRect().y},0)}};for(var t in i)e(t);document.getElementById("tags_list").appendChild(c),document.getElementById("tag_article_list").appendChild(s)}function renderTagsPage(){var t={};displayScrollTips(t,30),(new DataController).fetchAll(function(e){createTagPage(e.reduce(function(t,n){return n.tags&&0<n.tags.length?n.tags.forEach(function(e){t[e]||(t[e]=[]),t[e].push(n)}):t["未分类"].push(n),t},{"未分类":[]}),t),setTimeout(function(){var e=document.getElementById(window.location.hash.replace("#",""));e&&e.scrollIntoView()})})}